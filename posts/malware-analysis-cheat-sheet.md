---
author:
  name: "Darkrym"
date: 2025-06-02
linktitle: Malware Analysis
type:
- post
- posts
title: Malware Analysis Cheat Sheet
weight: 10
series:
- cheat_sheets
---

**Author: Lenny Zeltser | License: Creative Commons v3 “Attribution”**  
More at [zeltser.com/cheat-sheets](https://zeltser.com/cheat-sheets)

---

## 1. Malware Analysis Process

### Overview of the Malware Analysis Process

1. Use automated analysis sandbox tools for an initial assessment of the suspicious file.  
2. Set up a controlled, isolated laboratory in which to examine the malware specimen.  
3. Examine static properties and metadata of the specimen for triage and early theories.  
4. Emulate code execution to identify malicious capabilities and contemplate next steps.  
5. Perform behavioural analysis to examine the specimen’s interactions with its environment.  
6. Analyze relevant aspects of the code statically with a disassembler and decompiler.  
7. Perform dynamic code analysis to understand difficult aspects of the code.  
8. If necessary, unpack the specimen.  
9. Repeat steps 4–8 until analysis objectives are met.  
10. Augment your analysis using methods like memory forensics and threat intel.  
11. Document findings, save analysis artifacts, and clean up the laboratory.

---

### Behavioural Analysis

- Use virtualisation tools for system snapshots (Clonezilla, PXE, FOG, dd).
- Monitor local interactions:
  - `Process Hacker`, `Process Monitor`, `ProcDOT`, `Noriben`
- Detect system changes:
  - `RegShot`, `Autoruns`
- Monitor network traffic:
  - `Wireshark`, `Fiddler`
- Redirect traffic:
  - `fakedns`, `accept-all-ips`
- Simulate services:
  - `INetSim` or actual service setup

---

### Ghidra for Static Code Analysis

| Action                     | Shortcut         |
|---------------------------|------------------|
| Go to location            | `g`              |
| Show references           | `Ctrl+Shift+F`   |
| Insert comment            | `;`              |
| Follow jump or call       | `Enter`          |
| Previous/Next location    | `Alt+Left / Alt+Right` |
| Undo                      | `Ctrl+Z`         |
| Define data type          | `t`              |
| Add bookmark              | `Ctrl+D`         |
| Text search               | `Ctrl+Shift+E`   |
| Add/edit label            | `l`              |
| Disassemble               | `d`              |

---

### x64dbg/x32dbg for Dynamic Code Analysis

| Action                                 | Shortcut/Command     |
|----------------------------------------|-----------------------|
| Run code                               | `F9`                  |
| Step into / over                       | `F7 / F8`             |
| Execute until instruction              | `F4`                  |
| Execute until return                   | `Ctrl+F9`             |
| Previous/Next executed instruction     | `- / +`               |
| Return to previous view                | `*`                   |
| Go to expression                       | `Ctrl+G`              |
| Comment / Label                        | `; / :`               |
| Show current function graph            | `g`                   |
| Set breakpoint (instruction/API)       | `F2 / SetBPX APIName` |
| Highlight occurrences                  | `h` and click keyword |
| Assemble instruction                   | `Spacebar`            |
| Edit data in memory                    | `Ctrl+E`              |
| Extract API call references            | Right-click → Search for → Current module → Intermodular calls |

---

### Unpacking Malicious Code

- Detect packing: `Detect It Easy`, `Exeinfo PE`, `Bytehist`, `peframe`
- Quick unpack: Infect VM and dump memory with `Scylla`
- Precise unpack:
  - Find OEP (Original Entry Point) via debugger
  - Use `OllyDumpEx`
  - Set breakpoints on APIs: `LoadLibrary`, `VirtualAlloc`, etc.
  - Use memory breakpoints at stack entry
- Rebuild dumped file with `Scylla`, `pe_unmapper`
- If dumping fails, use dynamic analysis live

---

### Bypassing Other Analysis Defences

- Decode obfuscated strings:
  - Static: `FLOSS`, `xorsearch`, `Balbuzard`
  - Runtime: Set breakpoints and inspect memory
- Hide analysis tools: Use `ScyllaHide` plugin for x64dbg
- Patch out anti-analysis code manually
- Watch for tricky control flows: `TLS`, `SEH`, `RET`, `CALL`
- Use `scdbg` and `runsc` for shellcode
- Disable ASLR with `setdllcharacteristics`, `CFF Explorer`

---


---

## 2. Analyzing Malicious Documents

### General Approach to Document Analysis

1. Examine the document for anomalies, such as risky tags, scripts, and embedded artifacts.  
2. Locate embedded code, such as shellcode, macros, JavaScript, or other suspicious objects.  
3. Extract suspicious code or objects from the file.  
4. If relevant, deobfuscate and examine macros, JavaScript, or other embedded code.  
5. If relevant, emulate, disassemble and/or debug extracted shellcode.  
6. Understand the next steps in the infection chain.

---

### Microsoft Office Format Notes

- **OLE2 Format** (`.doc`, `.xls`, etc.): Binary; can store older macro versions in SRP streams.
- **OOXML Format** (`.docx`, `.xlsm`, etc.): ZIP-compressed; VBA inside OLE2 binary within ZIP.
- **XLM Macros**: Excel formulas, even without binary OLE2 stream.
- **RTF**: No macros, but supports embedded malicious objects.

---

### Useful MS Office File Analysis Commands

```bash
zipdump.py file.pptx                  # Examine OOXML contents
zipdump.py file.pptx -s 3 -d          # Extract file index 3
olevba file.xlsm                      # Extract macros
oledump.py file.xls -i                # List OLE2 streams
oledump.py file.xls -s 3 -v           # Extract VBA code
xmldump.py pretty                     # Format XML for analysis
oledump.py file.xls -p plugin_http_heuristics   # Find obfuscated URLs
vmonkey file.doc                      # Emulate macro execution
evilclippy -uu file.ppt               # Remove macro password
msoffcrypto-tool infile.docm outfile.docm -p    # Decrypt file
pcodedmp file.doc                     # Disassemble stomped VBA
pcode2code file.doc                   # Decompile stomped VBA
```

---

### Risky PDF Keywords

- `/OpenAction`, `/AA`: Auto-run scripts  
- `/JavaScript`, `/JS`, `/AcroForm`, `/XFA`: Embedded scripts  
- `/URI`, `/SubmitForm`, `/GoToR`: URL redirection  
- `/ObjStm`, `/XObject`: Hidden objects or images (phishing)  
- Be mindful of hex obfuscation (e.g. `/J#61vaScript`)

---

### Useful PDF File Analysis Commands

```bash
pdfid.py file.pdf -n                  # Show risky keywords
pdf-parser.py file.pdf -a            # Show stats
pdf-parser.py file.pdf -o ID         # Display object ID
pdf-parser.py file.pdf -r ID         # Objects referencing ID
qpdf --password=pass --decrypt infile.pdf outfile.pdf
```

---

### Shellcode and Other Analysis Commands

```bash
xorsearch -W -d 3 file.bin           # Locate shellcode
scdbgc /f file.bin                   # Emulate shellcode
runsc32 -f file.bin -n               # Execute shellcode
base64dump.py file.txt               # Detect base64 strings
numbers-to-string.py file            # Convert encoded numbers
```

---

### Additional Document Analysis Tools

- **JavaScript Deobfuscation**: `SpiderMonkey`, `cscript`, `box-js`
- **Office Macro Debugging**: Use built-in debugger in isolation
- **Macro Monitoring**: `AMSIScriptContentRetrieval.ps1`
- **Automation**: Use sandbox environments
- **Distributions**: REMnux includes many free analysis tools


---

## 3. Reverse Engineering Malicious Code

### Overview of the Code Analysis Process

1. Examine static properties of the executable.  
2. Identify strings and API calls for suspicious indicators.  
3. Use behavioural analysis (manual + automated).  
4. Emulate to find characteristics.  
5. Statical disassembly + decompilation.  
6. Dynamic debugging of API usage.  
7. Unpack code if needed.  
8. Annotate functions, rename variables.  
9. Expand analysis based on known code.  
10. Repeat steps 5–9 until objectives are met.

---

### Common 32-Bit Registers and Uses

| Register | Purpose |
|----------|---------|
| EAX      | General purpose (math, return values) |
| ECX      | Loop counter |
| EBP      | Stack frame base |
| ESP      | Stack top pointer |
| EIP      | Instruction pointer |
| EFLAGS   | Flags from arithmetic logic |
| FS       | Thread environment block (e.g., FS:[0]) |

---

### Common x86 Assembly Instructions

```asm
mov EAX, 0xB8       ; Load value into register
push EAX            ; Push onto stack
pop EAX             ; Pop from stack
lea EAX, [EBP-4]    ; Load effective address
call EAX            ; Call function by address
add ESP, 8          ; Adjust stack
xor EAX, EAX        ; Zero a register
test EAX, EAX       ; Check if zero
cmp EAX, 0xB8       ; Compare values
```

---

### Understanding 64-Bit Registers

- 32-bit → 64-bit: EAX → RAX, ECX → RCX, etc.
- Registers R8–R15 added
- Argument passing:
  - RCX, RDX, R8, R9 on 64-bit
  - [EBP+8], [EBP+0xC]... on 32-bit

---

### Decoding Conditional Jumps

| Mnemonic | Meaning |
|----------|---------|
| JA/JG    | Jump if above/greater |
| JB/JL    | Jump if below/less |
| JE/JZ    | Jump if equal (zero) |
| JNE/JNZ  | Jump if not equal (not zero) |
| JGE/JNL  | Jump if greater or equal |

---

### Risky Windows API Calls

- **Code injection**: `CreateRemoteThread`, `WriteProcessMemory`
- **DLL loading**: `LoadLibrary`, `GetProcAddress`
- **Data theft**: `GetClipboardData`, `GetWindowText`
- **Keylogging**: `GetAsyncKeyState`, `SetWindowsHookEx`
- **Self-injection**: `VirtualAlloc`, `VirtualProtect`
- **Execution**: `CreateProcess`, `WinExec`
- **Web traffic**: `InternetOpen`, `HttpSendRequest`

---

### Additional Code Analysis Tips

- Use dynamic analysis if static stalls
- Map control flow via jumps and calls
- Prefer simplicity: work from known to unknown
- Research official & native API names (`Nt*`, `Zw*`, `Rtl*`)

---

## 4. Tooling
### Analyze Windows Executables

- **Static**: [`manalyze`](https://github.com/JusticeRage/Manalyze), [`peframe`](https://github.com/guelfoweb/peframe), [`pefile`](https://github.com/erocarrera/pefile), [`exiftool`](https://exiftool.org/), [`clamscan`](https://www.clamav.net/), [`pescan`](http://pev.sourceforge.net/), [`portex`](https://github.com/katjahahn/PortEx), [`bearcommander`](https://github.com/hasherezade/bearparser/wiki), [`pecheck`](https://docs.remnux.org/discover-the-tools/examine+static+properties/pe+files#pecheck)
- **Strings & Deobfuscation**: [`pestr`](https://github.com/decalage2/balbuzard), [`bbcrack`](https://github.com/decalage2/balbuzard), [`brxor.py`](https://github.com/REMnux/distro/blob/master/files/brxor.py), [`base64dump`](https://blog.didierstevens.com/2020/07/03/update-base64dump-py-version-0-0-12/), [`xorsearch`](https://blog.didierstevens.com/programs/xorsearch/), [`flarestrings`](https://github.com/fireeye/stringsifter), [`floss`](https://github.com/fireeye/flare-floss), [`cyberchef`](https://github.com/gchq/CyberChef/)
- **Emulation**: [`binee`](https://github.com/carbonblack/binee), [`capa`](https://github.com/fireeye/capa), [`vivbin`](https://github.com/vivisect/vivisect)
- **Disassemblers**: [`ghidra`](https://ghidra-sre.org/), [`cutter`](https://cutter.re/), [`objdump`](https://en.wikipedia.org/wiki/Objdump), [`r2`](https://www.radare.org/n/radare2.html)
- **Unpackers**: [`bytehist`](https://www.cert.at/downloads/software/bytehist_en.html), [`de4dot`](https://github.com/0xd4d/de4dot), [`upx`](https://upx.github.io/)

### Reverse-Engineer Linux Binaries

- **Static**: [`trid`](https://mark0.net/soft-trid-e.html), [`exiftool`](https://exiftool.org/), [`pyew`](https://github.com/joxeankoret/pyew), [`readelf.py`](https://github.com/eliben/pyelftools)
- **Disassemblers**: `ghidra`, `cutter`, `objdump`, `r2`
- **Debuggers**: [`edb`](https://github.com/eteran/edb-debugger), [`gdb`](https://www.sourceware.org/gdb/)
- **Runtime tools**: [`ltrace`](https://docs.remnux.org/discover-the-tools/dynamically+reverse-engineer+code/elf+files#ltrace), [`strace`](https://strace.io/), [`frida`](https://frida.re/), [`sysdig`](https://github.com/draios/sysdig), [`unhide`](http://www.unhide-forensics.info/)

### Investigate Other Forms of Malicious Code

- **Android**: [`apktool`](https://ibotpeaches.github.io/Apktool/), [`droidlysis`](https://github.com/cryptax/droidlysis), [`androgui.py`](https://github.com/androguard/androguard), [`baksmali`](https://bitbucket.org/JesusFreke/smali), [`dex2jar`](https://github.com/pxb1988/dex2jar)
- **Java**: [`cfr`](https://www.benf.org/other/cfr/), [`procyon`](https://bitbucket.org/mstrobel/procyon), [`jad`](https://java-decompiler.github.io/), [`jd-gui`](https://java-decompiler.github.io/), [`idx_parser.py`](https://github.com/digitalsleuth/Java_IDX_Parser)
- **Python**: [`pyinstxtractor.py`](https://github.com/extremecoders-re/pyinstxtractor), [`pycdc`](https://github.com/zrax/pycdc)
- **JavaScript**: [`js`](https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey), `js-file`, [`objects.js`](https://github.com/REMnux/salt-states/blob/master/remnux/config/objects/objects.js), [`box-js`](https://github.com/CapacitorSet/box-js)
- **Shellcode**: [`shellcode2exe.bat`](https://github.com/repnz/shellcode2exe), [`scdbg`](http://sandsprite.com/blogs/index.php?uid=7&pid=152), `xorsearch`
- **PowerShell**: [`pwsh`](https://github.com/powershell/powershell), `base64dump`
- **Flash**: [`swfdump`](http://swftools.org/), [`flare`](http://www.nowrap.de/flare.html), [`flasm`](http://www.nowrap.de/flasm.html), `swf_mastah.py`, [`xxxswf`](https://github.com/viper-framework/xxxswf)

### Examine Suspicious Documents

- **Office**: [`vmonkey`](https://www.decalage.info/en/vba_emulation), [`pcodedmp`](https://github.com/bontchev/pcodedmp), [`olevba`](http://www.decalage.info/python/oletools), [`xlmdeobfuscator`](https://github.com/DissectMalware/XLMMacroDeobfuscator), [`oledump.py`](https://blog.didierstevens.com/programs/oledump-py/), [`msoffice-crypt`](https://github.com/herumi/msoffice), [`ssview`](https://www.mitec.cz/ssv.html)
- **RTF**: [`rtfobj`](http://www.decalage.info/python/oletools), [`rtfdump`](https://blog.didierstevens.com/2018/12/10/update-rtfdump-py-version-0-0-9/)
- **Emails**: [`emldump`](https://blog.didierstevens.com/2017/07/21/update-emldump-py-version-0-0-10/), [`msgconvert`](https://www.matijs.net/software/msgconv/)
- **PDFs**: [`pdfid`, `pdfparser`, `pdfextract`, `pdfdecrypt`](https://blog.didierstevens.com/programs/pdf-tools/), [`peepdf`](https://eternal-todo.com/tools/peepdf-pdf-analysis-tool), [`pdftk`](https://gitlab.com/pdftk-java/pdftk), [`pdfresurrect`](https://github.com/enferex/pdfresurrect), [`qpdf`](http://qpdf.sourceforge.net/), [`pdfobjflow`](https://bitbucket.org/sebastiendamaye/pdfobjflow)
- **General**: `base64dump`, [`tesseract`](https://github.com/tesseract-ocr/tesseract), `exiftool`

---
### Explore Network Interactions

- **Monitoring**: [`burpsuite`](https://portswigger.net/), [`networkminer`](https://www.netresec.com/), [`polarproxy`](https://www.netresec.com/?page=PolarProxy), [`mitmproxy`](https://mitmproxy.org/), [`wireshark`](https://www.wireshark.org/), [`tshark`](https://www.tcpdump.org/), [`ngrep`](https://github.com/jpr5/ngrep), [`tcpxtract`](http://tcpxtract.sourceforge.net/), [`tcpick`](https://github.com/rupor-github/tcpick)
- **Connecting**: [`thug`](https://github.com/buffer/thug), [`nc`](https://nc110.sourceforge.io/), [`tor`](https://www.torproject.org/), [`wget`](https://www.gnu.org/software/wget/), [`curl`](https://curl.haxx.se/), [`irc`](http://www.epicsol.org/), [`ssh`](https://man.openbsd.org/ssh.1), [`unfurl`](https://github.com/obsidianforensics/unfurl)
- **Services**: [`fakedns`](https://code.activestate.com/recipes/491264-mini-fake-dns-server/), [`fakemail`](https://hg.sr.ht/~olly/fakemail), [`accept-all-ips`](https://github.com/REMnux/distro/blob/master/files/accept-all-ips), `nc`, [`httpd`](https://nginx.org/), [`inetsim`](https://www.inetsim.org/), [`fakenet`](https://github.com/fireeye/flare-fakenet-ng), [`sshd`](https://man.openbsd.org/sshd.8), [`myip`](https://github.com/REMnux/distro/blob/master/files/myip)

---

### Gather and Analyze Data

- **Network**: [`Automater.py`](http://www.tekdefense.com/automater/), [`shodan`](https://github.com/achillean/shodan-python/), [`ipwhois_cli.py`](https://github.com/secynic/ipwhois), [`pdnstool`](https://github.com/chrislee35/passivedns-client)
- **Hashes**: [`malwoverview.py`](https://github.com/digitalsleuth/malwoverview), [`nsrllookup`](https://github.com/rjhansen/nsrllookup), `Automater.py`, [`vt`](https://github.com/doomedraven/VirusTotalApi), [`virustotal-search.py`](https://blog.didierstevens.com/programs/virustotal-tools/)
- **Files**: [`yara`](https://virustotal.github.io/yara/), [`scalpel`](https://github.com/sleuthkit/scalpel), [`bulk_extractor`](https://github.com/simsong/bulk_extractor), [`ioc_writer`](https://github.com/mandiant/ioc_writer)
- **Other**: [`dexray`](http://www.hexacorn.com/blog/category/software-releases/dexray/), [`viper`](https://github.com/viper-framework/viper), [`time-decode.py`](https://github.com/digitalsleuth/time_decode)

---

### Other Analysis Tasks – Memory Forensics & File Utilities

- **Memory Forensics**: [`vol.py`](https://github.com/volatilityfoundation/volatility3), [`vol3`](https://github.com/volatilityfoundation/volatility3), [`linux_mem_diff.py`](https://github.com/monnappa22/linux_mem_diff_tool), [`aeskeyfind`](https://citp.princeton.edu/our-work/memory/), [`rsakeyfind`](https://citp.princeton.edu/our-work/memory/), `bulk_extractor`
- **File Editors**: [`wxHexEditor`](https://sourceforge.net/projects/wxhexeditor/), [`scite`](https://www.scintilla.org/SciTE.html), [`code`](https://code.visualstudio.com/), [`xpdf`](http://www.xpdfreader.com/), [`convert`](https://imagemagick.org/)
- **Extractors**: [`7z`](https://www.7-zip.org/), [`unzip`](http://infozip.sourceforge.net/), [`unrar`](https://www.rarlab.com/), [`cabextract`](https://www.cabextract.org.uk/)


## 5. REMnux Tips for Malware Analysis on Linux

### Get Started with REMnux

- Install REMnux via VM, dedicated system, or on existing distro
- Docs: [docs.remnux.org](https://docs.remnux.org)
- Keep updated: `remnux upgrade` and `remnux update`
- Use Docker-based tools
- Default login: `remnux/malware`

---

### Operate Your REMnux System

```bash
shutdown             # Power off
reboot               # Reboot
sudo -s              # Root shell
renew-dhcp           # Renew DHCP lease
myip                 # Show IP address
code file            # Edit text
feh file             # View image
httpd start          # Start web server
sshd start           # Start SSH
```

---
---

### Use Docker Containers for Analysis

- `remnux/thug`, `remnux/jsdetox`, `remnux/retdec`
- `remnux/viper`, `remnux/radare2`

---

### Interact with Docker Images

```bash
docker images             # List images
docker pull <image>       # Update image
docker rmi <image_id>     # Remove image
docker system prune       # Clean up
docker run --rm -it image bash            # Run container shell
docker run -p 80:80 image bash            # Map port
docker run -v .:/data image bash          # Mount directory
```

---
